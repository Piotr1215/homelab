---
apiVersion: v1
kind: ConfigMap
metadata:
  name: dnsmasq-config
  namespace: kube-system
data:
  dnsmasq.conf: |
    # Don't read /etc/resolv.conf or /etc/hosts
    no-resolv
    no-hosts

    # Listen on all interfaces (container network)
    listen-address=0.0.0.0
    port=53

    # Cache settings
    cache-size=1000

    # Logging (disable after testing)
    log-queries
    log-facility=-  # Log to stderr (captured by kubectl logs)

    # Internal domain: *.homelab.local â†’ Envoy Gateway
    address=/homelab.local/192.168.178.92

    # Forward all other queries to external DNS (Quad9 + Cloudflare)
    server=9.9.9.9
    server=149.112.112.112
    server=1.1.1.1

    # DNSSEC validation
    dnssec
    trust-anchor=.,20326,8,2,E06D44B80B8F1D39A95C0B0D7C65D08458E880409BBC683457104237C7F8EC8D
    dnssec-check-unsigned

    # Additional hardening
    bogus-priv
    domain-needed
