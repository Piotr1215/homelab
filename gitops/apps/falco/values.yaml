# Driver configuration - using modern eBPF probe (default)
driver:
  enabled: true
  kind: modern_ebpf

# Controller configuration
controller:
  kind: daemonset
  daemonset:
    updateStrategy:
      type: RollingUpdate

# Resource limits appropriate for homelab
resources:
  requests:
    cpu: 100m
    memory: 512Mi
  limits:
    cpu: 1000m
    memory: 1024Mi

# Falco configuration
falco:
  # Enable gRPC output for future integrations
  grpc:
    enabled: true
    bind_address: "unix:///run/falco/falco.sock"
    threadiness: 0

  # Enable HTTP output for webhook integrations
  http_output:
    enabled: false
    url: ""

  # Metrics configuration - native Prometheus support
  metrics:
    enabled: true
    interval: 1h
    output_rule: true
    rules_counters_enabled: true
    resource_utilization_enabled: true
    state_counters_enabled: true
    kernel_event_counters_enabled: true
    libbpf_stats_enabled: true
    plugins_metrics_enabled: true

  # JSON output for better parsing
  json_output: true
  json_include_output_property: true
  json_include_tags_property: true

  # Log stderr and syslog
  log_stderr: true
  log_syslog: true
  log_level: info

  # Priority levels to log
  priority: debug

  # Disable config file watching to avoid inotify issues
  watch_config_files: false

# Disable falcoctl automatic rules updates (use bundled rules)
falcoctl:
  artifact:
    install:
      enabled: false
    follow:
      enabled: false

# Falcosidekick for event routing and Web UI
falcosidekick:
  enabled: true
  webui:
    enabled: true
    replicaCount: 1
    # TTL for Redis keys - keep events for 7 days (reduced from 30d)
    ttl: "7d"
    service:
      type: ClusterIP
      port: 2802
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 128Mi
    redis:
      livenessProbe:
        initialDelaySeconds: 300
        periodSeconds: 5
        timeoutSeconds: 2
        failureThreshold: 3
      resources:
        requests:
          cpu: 50m
          memory: 512Mi
        limits:
          cpu: 200m
          memory: 1Gi

# Enable ServiceMonitor for Prometheus scraping
serviceMonitor:
  enabled: true
  interval: "30s"
  scrapeTimeout: "10s"
  additionalLabels: {}

# Prometheus rules for alerting
prometheusRules:
  enabled: true
  additionalLabels: {}

# Grafana dashboard
grafanaDashboard:
  enabled: true
  namespace: prometheus
  prometheusDatasourceName: Prometheus

# Enable services
services:
  - name: metrics
    type: ClusterIP
    ports:
      - port: 8765
        targetPort: 8765
        protocol: TCP
        name: metrics

# Tolerations to run on all nodes including control plane
tolerations:
  - effect: NoSchedule
    key: node-role.kubernetes.io/control-plane
  - effect: NoSchedule
    key: node-role.kubernetes.io/master

# Pod Security Context
podSecurityContext:
  runAsUser: 0
  runAsGroup: 0
  fsGroup: 0

# Container Security Context
securityContext:
  privileged: true
