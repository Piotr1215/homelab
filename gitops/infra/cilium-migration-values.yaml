---
# Cilium Helm Chart Values - Migration Configuration
# This enables dual-overlay mode with Calico during migration
# For: Cilium v1.16.x on kubeadm cluster

# Don't replace kube-proxy yet - keep dual-proxy mode
kubeProxyReplacement: disabled

# IPAM configuration
ipam:
  mode: "cluster"
  operator:
    clusterPoolIPv4PodCIDRList:
      - "10.233.64.0/18"  # Verified from cluster config

# Critical for dual-CNI coexistence with Calico
hostLegacyRouting: true

# During migration, don't enforce policies (enable after migration)
policyEnforcementMode: "never"

# Don't restart pods during initial CNI config installation
unmanagedPodWatcher:
  restart: false

# Use VXLAN overlay (similar to Calico, familiar model)
routingMode: "tunnel"
tunnelProtocol: "vxlan"

# Different VXLAN port to avoid collision with Calico
vxlanPort: 8472

# Observability - Enable Hubble from the start
hubble:
  enabled: true
  relay:
    enabled: true
  ui:
    enabled: true
    service:
      type: LoadBalancer
      loadBalancerIP: "192.168.178.94"

# Prometheus metrics for monitoring
prometheus:
  enabled: true
  port: 9090
  metrics: "basic"

# Load balancer mode - DSR for better performance
loadBalancer:
  mode: "dsr"

# Don't manage node networking initially (Calico still does)
customConf: true

# Enable operator for HA
operator:
  enabled: true
  replicas: 2

# Pod security settings
podSecurityPolicy:
  enabled: true

# Agent health
healthPort: 9876

# Endpoint garbage collection
endpointGCInterval: "5m"
endpointGCState: "following-state"

# Image configuration
image:
  registry: quay.io
  repository: cilium/cilium
  tag: "1.16.1"

# Operator image
operator:
  image:
    registry: quay.io
    repository: cilium/operator
    tag: "1.16.1"

# Resource requests/limits
resources:
  limits:
    cpu: 1000m
    memory: 1024Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Node selector (all nodes)
nodeSelector: {}

# Tolerations for all node types
tolerations:
  - effect: NoExecute
    operator: Exists
  - effect: NoSchedule
    operator: Exists

